## Airlocks

I may be getting ahead of myself, because there's many things to do before I'm ready implement airlocks, but I've been thinking about them.  I need to have them, obviously.  I have an idea for how to do it, but I'm not sure it will work.

I would make "airlock door" as a special kind of door.  Unlike a regular door, the airlock door needs to equalize the pressure on both sides before it will open.  If two or more airlock doors are on the same room, then that room can function as an airlock.  Since an airlock doesn't work if both doors are open, airlock doors need to have a mutex with any other airlock doors in the same airlock so only one can be opened or trying to equalize pressure at a time.  Of course, there should be a way for the player to override the airlock mutex and open both doors to vent the ship.  If that's what they want to do.

I could have airlock doors be linked up automatically, when a new one is built it can discover airlock doors that it shares a new room with.  That seems better than making the user link them together.  It would be possible for a airlock door to be a member of two separate airlocks.  This might not be a useful configuration, but I feel like it needs to work anyway. It would also be possible for there to be regular doors into airlocks.  This might cause the airlock to not function properly.

In order to equalize pressure, airlocks doors would need to know which side of the door to match.  Preferably, they should change the inside of the airlock to match the outside.  For airlocks doors that are part of two airlocks, since both sides of the door are inside an airlock, it would attempt to adjust both sides at the same rate.  The size of the airlock would affect the cycle time, since it takes longer to move larger volumes of air.  I want to allow for airlocks to conserve air, meaning we don't just vent it to space, we pump the air into tanks, probably recycling it back into the atmosphere maintenance machine.  If the airlock is not connected to a working storage system, then it will just vent the higher pressure side into the lower.  

There is also the problem of multiple crew members.  If two crew members are trying to enter the airlock at once, only one will be successful thanks to the mutex.  If one crew member is already inside the airlock, then that crew member needs to get out before any other crew member can get in.  The mutex isn't enough in that case.  I could end up with many crew members standing in the same square all using the airlock at the same time.  I'm reminded of Dwarf Fortress where infinity dwarves can occupy the same square as long as infinity minus one of them are lying down.  Every solution to the crew collision problem has problems.  It's pretty silly to allow lots of crew to occupy the same square at the same time.  If I don't let crew occupy the same square ever, then pathfinding becomes a problem.  Dwarf Fortress's solution is awkward, and is not actually less silly than letting crew pass through each other like ghosts. Or a super fluid.
